# UpCoach LLM Server - Production Environment Configuration
# IMPORTANT: Use secrets management for sensitive values in production

# =============================================================================
# API Security
# =============================================================================

# API key for gateway authentication
# In production, inject from secrets manager (AWS Secrets Manager, Vault, etc.)
LLM_API_KEY=${SECRET_LLM_API_KEY}

# =============================================================================
# Model Configuration
# =============================================================================

# Primary model for vLLM
VLLM_MODEL=mistralai/Mistral-7B-Instruct-v0.2

# Default model for requests
DEFAULT_MODEL=mistral

# =============================================================================
# Rate Limiting
# =============================================================================

# Requests per minute limit per user/IP
RATE_LIMIT_RPM=60

# =============================================================================
# Caching
# =============================================================================

# Response cache TTL in seconds (1 hour)
CACHE_TTL=3600

# =============================================================================
# Logging
# =============================================================================

# Log level (minimal logging in production)
LOG_LEVEL=warn

# =============================================================================
# Server Ports
# =============================================================================

GATEWAY_PORT=3100
OLLAMA_PORT=11434
VLLM_PORT=8000
REDIS_PORT=6379

# =============================================================================
# GPU Configuration
# =============================================================================

# Maximize GPU utilization in production
GPU_MEMORY_UTILIZATION=0.9

# Adjust based on GPU count
TENSOR_PARALLEL_SIZE=1

# =============================================================================
# Ollama Settings
# =============================================================================

# Restrict to production domains only
OLLAMA_ORIGINS=https://app.upcoach.com,https://api.upcoach.com

# Production parallel processing
OLLAMA_NUM_PARALLEL=8
OLLAMA_MAX_LOADED_MODELS=2

# =============================================================================
# Redis Settings
# =============================================================================

# Redis cluster URL (for production scalability)
REDIS_URL=redis://redis:6379
REDIS_MAXMEMORY=1gb

# =============================================================================
# Security Settings
# =============================================================================

# Require authentication
SKIP_AUTH=false

# Enable TLS (handled by load balancer in most cases)
TLS_ENABLED=true

# CORS allowed origins
CORS_ORIGINS=https://app.upcoach.com

# =============================================================================
# Monitoring & Observability
# =============================================================================

# Enable metrics collection
ENABLE_METRICS=true

# Metrics export interval (seconds)
METRICS_INTERVAL=30

# Enable distributed tracing
ENABLE_TRACING=true

# Datadog/New Relic agent host
APM_HOST=datadog-agent

# =============================================================================
# Performance Tuning
# =============================================================================

# Maximum request body size
MAX_REQUEST_SIZE=10mb

# Request timeout (ms)
REQUEST_TIMEOUT=60000

# Keep-alive timeout (ms)
KEEPALIVE_TIMEOUT=65000

# =============================================================================
# Health Checks
# =============================================================================

# Health check interval (seconds)
HEALTH_CHECK_INTERVAL=30

# Readiness probe initial delay (seconds)
READINESS_DELAY=60

# =============================================================================
# Backup & Recovery
# =============================================================================

# Enable response backup to S3
ENABLE_BACKUP=true

# S3 bucket for backups
BACKUP_BUCKET=upcoach-llm-backups

# Backup retention days
BACKUP_RETENTION_DAYS=30
